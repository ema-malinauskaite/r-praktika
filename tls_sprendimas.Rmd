---
title: "tiesines lygciu sistemos sprendimas"
author: "Ema Malinauskaite"
date: "2/18/2020"
output: html_document
---

```{r include=FALSE}
library("tidyverse")
library("data.table")
library("compareDF")
library("tidyr")
#library("matlib")
library("pracma")
#library("Smisc")
```

# Tiesines lygciu sistemos sprendimas
## Duomenys imant wt ir wtx kartu
Duomenu ikelimas:
```{r}
lizocimai_pagr <- readr::read_rds("./data/pro_344_sm_suppinfo.rds")
nuline_lentele_platusis <- readr::read_rds("./data/nuline_lentele_platusis.rds")
wtx_1L63_platusis <- readr::read_rds("./data/wtx_1L63_platusis.rds")
wt_2LZM_platusis <- readr::read_rds("./data/wt_2LZM_platusis.rds")
```

```{r}
pdb_tm <- lizocimai_pagr %>% 
  select(pdb, deltaTm, WT) %>% 
  drop_na(pdb, deltaTm) %>% 
  filter(pdb != "2LZM" & pdb != "1L63")

pdb_tm
```

Matricu sukurimas:
```{r message=FALSE}
matricu_lenteles_wtx_ir_wt <- fun_kont_sum_ir_temp_skirtumams(pdb_tm, wtx_platusis = wtx_1L63_platusis, wt_platusis = wt_2LZM_platusis, nuline_lentele_platusis)
```

```{r}
matricos_A_perziura <- matricu_lenteles_wtx_ir_wt$visu_baltymu_kont_sumu_skirtumai %>% data.frame()
```

### Sprendimas

Reiksmiu priskyrimas:
```{r}
A <- matricu_lenteles_wtx_ir_wt$visu_baltymu_kont_sumu_skirtumai %>% .[, -225] #.[-c(230:328), -225]
b <- c(matricu_lenteles_wtx_ir_wt$termo_skirtumai) # %>% .[-c(230:328)]
dim(A)
```

Surasti netinkamiems:
```{r}
# rankifremoved <- sapply(1:ncol(A), function (x) qr(A[,-x])$rank)
# rankifremoved
# which(rankifremoved == max(rankifremoved))
```

Patikrinimas:
(Echelono forma, supaprastinta, jeigu paskutine eilute yra ne nuliai, ir turi sprendini, viskas ok)
```{r}
# echelon <- echelon(A, b)
# echelon_df <- data.frame(echelon) %>% tail()
# echelon_df
```

Sprendimas:
PADARYTI KITA KARTA KAD BUTU KODAS SU SOLVE BE QR, TY KAD SKAICIUOTU TIK IS 29 NES O JEIGU REIKES PAVYZDZIU
```{r}
#tls_sprendimas_wt_ir_wtx <- solve(A, b)
tls_sprendimas_wt_ir_wtx_qr <- pracma::qrSolve(A, b)
```

```{r}
tls_sprendimas_wt_ir_wtx_df <- tls_sprendimas_wt_ir_wtx %>% data.frame() 
tls_sprendimas_wt_ir_wtx_df

# data.table::fwrite(
#   tls_sprendimas_wt_ir_wtx_df,
#   file = "./rezultatai/koef_visi_lizocimai_qr_metodu_be_TRP.txt",
#   sep = "\t",
#   dec = ".",
#   row.names  = FALSE,
#   col.names  = TRUE,
#   na = ""
# )
```

## Aprasomoji rezultatu statistika
```{r}
tls_sprendimas_wt_ir_wtx_df_pasalinus <- tls_sprendimas_wt_ir_wtx_df %>% 
  filter(. != min(tls_sprendimas_wt_ir_wtx_df)) 

tls_sprendimas_wt_ir_wtx_df %>%  summary()
tls_sprendimas_wt_ir_wtx_df_pasalinus %>% summary()

tls_sprendimas_wt_ir_wtx_df %>% as.data.table(keep.rownames = "pavadinimas") %>% 
  filter(. == min(.), .preserve = TRUE)

sort(tls_sprendimas_wt_ir_wtx) %>% data.frame()

```

Destytojo pavyzdys:
(naudojami indeksai, tada su jais dirbama toliau, reikalingos matricos)
```{r}
ids=order(tls_sprendimas_wt_ir_wtx);
which(tls_sprendimas_wt_ir_wtx>0);
```


```{r}
ggplot(tls_sprendimas_wt_ir_wtx_df_pasalinus) +
 aes(x = .) +
 geom_histogram(bins = 30L, fill = "#0c4c8a") +
 theme_minimal()
```

