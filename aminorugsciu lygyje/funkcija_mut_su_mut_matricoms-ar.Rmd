---
title: "funkcija matricoms sudaryti, mutanto su mutantu"
author: "Ema Malinauskaite"
date: "2/18/2020"
output: html_document
---


KOL KAS PALIKTAS SENAS WT SU MUT KODAS KURIS VEIKE ANKSCIAU, GALBUT KAZKAS PAKEISTA, VELIAU KODAI NEBESUTAMPA

```{r include=FALSE}
library("tidyverse")
library("data.table")
library("compareDF")
library("tidyr")
library("matlib")
```


# fun_kont_sum_ir_temp_skirtumams
## Funkcijos rasymas
Si funkcija, su duotais inputais cikle pirmiausiai turetu is pbd_termo pasiimti pirmo baltymo pdb ir perleisti per fun_kontaktu_sumai. Tada, kai turi standartizuota baltymo kontaktu lentele, ja reiketu prideti prie WT lenteles, kadangi jos abi yra placiuoju formatu, naudoti full_join kad sutikrintu pagal stulpeliu pavadinimus. Pavertus i ilgaji formata lenteleje su funkcija summarise suskaiciuoti skirtuma tada paversti i platuju formata vel ir prideti prie bendros lenteles kur kiekvienoj eilutej bus dvieju baltymu kontaktu skirtumas, o stulpely kontakto tipas. Po ciklo tokia lentele reiktu paversti matrica. 
Taip pat ciklo metu reiktu paimti temperatura, ja atimti is wt temperaturos ir prideti i kita lentele, kuri irgi bus naudojama tiesinems lygtims.
Outputas turetu buti dvi matricos: viena kuri turi 230 stulpeliu ir tiek eiluciu, kiek yra baltymu, kita tureti tik viena stulpeli pasirinktam termodinaminiam parametrui ir tiek pat eiluciu kaip ir kita matrica.

```{r message=FALSE}
#input:
# pdb_termo_lent - lentele, kurioje vienas stulpelis pasirinktas termodinaminis parametras, kitas stulpelis pdb failo pavadinimas
# WT_platusis - sutvarkyta pasirinkto wt placiojo formato, su kuriuo bus lyginami kiti baltymai lentele su kontaktu plotu sumomis
# WT_termo - pasirinkto termodinaminio parametro reiksme pasirinktam WT tipui
# nul_lent_plat - nuline lentele skirta fun_kontaktu_sumai

fun_kont_sum_ir_temp_skirtumams <- function(pdb_termo_lent, WT_platusis, WT_termo, nul_lent_plat) {
visu_baltymu_kont_sumu_skirtumai <- data.frame()
termo_skirtumai <- data.frame() #desine tiesiniu lygciu sistemos puse matricose
#----
for (i in pdb_termo_lent$pdb) {
lizocimo_kontaktai <- data.table::fread(paste("../lizocimai/",i,".contacts.interresidue.table", sep = ""))
kontaktu_sumos <- fun_kontaktu_sumai(lizocimo_kontaktai, nul_lent_plat)
wt_ir_lizocimas <- rbind(WT_platusis, kontaktu_sumos) %>%
  transpose(keep.names = "kontakto_tipas") %>% 
  mutate(kont_sumu_skirtumas = V1 - V2) %>% 
  select(kontakto_tipas, kont_sumu_skirtumas) %>% 
  transpose(make.names = "kontakto_tipas")
visu_baltymu_kont_sumu_skirtumai <- rbind(visu_baltymu_kont_sumu_skirtumai, wt_ir_lizocimas)
lizocimo_kontaktai = NULL
#----
termo <- pdb_termo_lent %>% 
  filter(pdb == i) %>% 
  mutate(termo_skirtumas = WT_termo - .[[2]]) %>% 
  select(-Tm) 
termo_skirtumai <- rbind(termo_skirtumai,termo) 
 }
termo_skirtumai <- termo_skirtumai %>%
  transpose(make.names = TRUE)
return(list(visu_baltymu_kont_sumu_skirtumai = as.matrix(visu_baltymu_kont_sumu_skirtumai),termo_skirtumai = as.matrix(termo_skirtumai)))
}
```

## Matricos paruosimas
### Paruosiamos wt ir wtx kontaktu plotu lenteles
```{r include=FALSE}
nuline_lentele_platusis <- readr::read_rds("../data/nuline_lentele_platusis.rds")
wt_2LZM_platusis <- data.table::fread("../lizocimai/2LZM.contacts.interresidue.table")
wtx_1L63_platusis <- data.table::fread("../lizocimai/1L63.contacts.interresidue.table")

wt_2LZM_platusis <- fun_kontaktu_sumai(wt_2LZM_platusis, nuline_lentele_platusis)
wtx_1L63_platusis <- fun_kontaktu_sumai(wtx_1L63_platusis, nuline_lentele_platusis)

#readr::write_rds(wt_2LZM_platusis, "./data/wt_2LZM_platusis.rds")
#readr::write_rds(wtx_1L63_platusis, "./data/wtx_1L63_platusis.rds")
```

### Duomenys bandymui
Bandymui bus naudojama WT = wt temperaturu lentele, kurioje isfiltruoti tiek pdb na, tiek tm na ir paimtos pirmos 6 eilutes.

Duomenu ikelimas:
```{r}
lizocimai_pagr <- readr::read_rds("../data/pro_344_sm_suppinfo.rds")
wt_2LZM_platusis <- readr::read_rds("../data/wt_2LZM_platusis.rds")
```

```{r}
pdb_tm_wt_pvz <- lizocimai_pagr %>% 
  filter(WT == "wt") %>% 
  select(pdb, Tm) %>% 
  drop_na(pdb, Tm) %>% 
  head()

pdb_tm_wt_pvz
```

# Bandymas
```{r message=FALSE}
matricu_lenteles_pvz <- fun_kont_sum_ir_temp_skirtumams(pdb_tm_wt_pvz, wt_2LZM_platusis, 67.2, nuline_lentele_platusis)
```

```{r}
matricu_lenteles_pvz$termo_skirtumai
data.frame(matricu_lenteles_pvz$visu_baltymu_kont_sumu_skirtumai)
```
